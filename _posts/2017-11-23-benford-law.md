---
title: A Lei de Benford e a beleza dos n√∫meros
layout: post
---

Conte o n√∫mero de habitantes de cada cidade brasileira. Coloque isso numa tabela e me diga, quantas vezes cada n√∫mero (de 1 a 9) se repete como primeiro d√≠gito da contagem. T√°, n√≥s temos 5570 munic√≠pios no Brasil, contar a frequ√™ncia de cada primeiro d√≠gito vai cansar ent√£o pode chutar vai, eu deixo. Me diz qual a probabilidade de encontrar o 1 como primeiro d√≠gito? E qual a probabilidade de encontrar o 2 como primeiro d√≠gito?

![gif da cena de contas do filme se beber nao case](https://media.giphy.com/media/BmmfETghGOPrW/giphy.gif)
<center>
<a href="https://media.giphy.com/media/BmmfETghGOPrW/giphy.gif">
<i>Fonte</i>
</a>
</center>

E se eu te dissesse que, ao contr√°rio do que imaginamos, a distribui√ß√£o de "primeiros digitos" n√£o √© a mesma para os algarismos de 1 a 9  üò±üò±üò±  Pelo menos n√£o num conjunto "natural" ou de n√∫meros aleat√≥rios.

## Os primeiros d√≠gitos num conjunto n√∫merico
Okay, se o que a gente esperava n√£o √© verdade, ent√£o qual √© a verdadeira distribui√ß√£o?! Foi essa pergunta que Frank Benford ajudou a responder. 

### Frank Benford
[Benford](https://en.wikipedia.org/wiki/Frank_Benford) era um f√≠sico americano que pegou as observa√ß√µes iniciais de um astronomo [Simon Newcomb](https://en.wikipedia.org/wiki/Simon_Newcomb), generalizou e aplicou para v√°rios datasets provando a exist√™ncia de um padr√£o diferente daquele que a gente pensava ali no come√ßo do post.

### A Lei
Tamb√©m conhecida como a Lei dos Primeiros D√≠gitos, a Lei de Benford define que a probabilidade do primeiro d√≠gito de um n√∫mero segue uma fun√ß√£o logarit√≠mica que mostro abaixo:

$$P (d) =  \log_{10} \left(1 + \frac{1}{d} \right)$$

A probabilidadade do primeiro d√≠gito de um n√∫mero ser $$d$$ √© dada pelo $$\log$$ na base $$10$$ de $$1 + \frac{1}{d}$$. Por exemplo se tomarmos $$ d = 1 $$ e $$ d = 9 $$ temos:

$$P (1) =  \log_{10} \left(1 + \frac{1}{1} \right) = \log_{10} \left(1+1\right) = \log_{10} 2 = 0.3010 $$

$$P (9) =  \log_{10} \left(1 + \frac{1}{9} \right) = \log_{10} \left(1+0.11\right) = \log_{10} 1.11 = 0.0453$$

Com isso sabemos que, a probabilidade de termos um $$1$$ como primeiro d√≠gito √© seis vezes maior de encontrarmos um $$9$$ como primeiro d√≠gito. Louco n√©?

![gif da nazar√© confusa](https://media.giphy.com/media/l44QkVjrTiBgettq8/giphy.gif)
<center>
<a href="https://media.giphy.com/media/l44QkVjrTiBgettq8/giphy.gif">
<i>Fonte</i>
</a>
</center>

### Isso √© muita matem√°tica pra mim, cad√™ o c√≥digo?
Vamos l√°! Hoje vou usar R para demonstrar com c√≥digo como funciona a Lei de Benford. O objetivo dos passos a seguir √© crirar um script que gere autom√°ticamente o gr√°fico da an√°lise de benford e um gr√°fico para a frequ√™ncia de cada um dos primeiros d√≠gitos.

#### Instalando
Comece instalando o R seguindo as instru√ß√µes dispon√≠veis [no site oficial do projeto](https://cran.r-project.org/).

Depois no seu diret√≥rio de trabalho crie um arquivo para instalar as dependencias, voc√™ pode chamar esse arquivo do que quiser, aqui vou chamar de `install_packages.R`:

~~~ r
options(repos = subset(getCRANmirrors(), Country == "Brazil")$URL)
install.packages("benford.analysis")
~~~

O `install_packages.R` se encarrega de instalar o pacote [`benford.analysis`](https://github.com/carloscinelli/benford.analysis) que traz pronto um conjunto de fun√ß√µes para analisar os dados contra a distribui√ß√£o de Benford. Para rodar fazemos:

~~~ console
$ Rscript install_packages.R
~~~

#### Rodando o script
Depois criei um arquivo que chamei de `benfords_law.R` que vai conter os pr√≥ximos blocos de c√≥digo.

Come√ßamos importando/carregando o nosso pacote escolhido e depois escolhendo um dataset de exemplo que vem com o pacote e cont√©m o censo da Popula√ß√£o das Cidades dos Estados Unidos em  2009, veja:

~~~ r
require("benford.analysis")              # Carrega o pacote benford.analysis
data("census.2009")                      # Carrega o dataset 
~~~

A fun√ß√£o principal desse pacote √© a `benford()` √© ela que faz todos os calculos em cima dos meus dados para validar os dados de acordo com a Lei de Benford. Ela ir√° receber um array num√©rico e podemos dizer quantos primeiros d√≠gitos queremos an√°lisar usando o argumento `number.of.digits`, o padr√£o para esse argumento √© `2`, mas aqui vamos usar `1` por quest√µes demonstrativas:

~~~ r
bfd <- benford(census.2009$pop.2009,     # Coluna com o censo por cidade em 2009
               number.of.digits = 1)     # N√∫mero de Primeiros D√≠gitos para analisar
~~~

E plotando o gr√°fico temos o seguinte resultado:

~~~ r
plot(bfd)
~~~

![gr√°ficos original](https://raw.githubusercontent.com/jtemporal/talks/master/benfords-law/benford-population-us.png)
<center>
<i>Gr√°fico Original gerado pela fun√ß√£o <code class="highlighter-rouge">benford()</code>.</i>
</center>

Agora, vamos reproduzir o primeiro gr√°fico separadamente. Esse primeiro gr√°fico traz alguns elementos interessantes:

- Cada barra indica a frequ√™ncia observada para cada primeiro d√≠gito dentro do dataset;
- A linha vermelha tra√ßa a frequ√™ncia esperada caso aquele dataset esteja de acordo com a distribui√ß√£o de Benford;

Para reproduzir esse gr√°fico come√ßamos utilizando a fun√ß√£o para plotar um gr√°fico de barras `barplot()`. Passamos para ela as frequ√™ncias calculadas pela fun√ß√£o `benford()` para cada primeiro d√≠gito que se encontram em `bfd$bfd$data.dist.freq`. Os demais atributos setados s√£o para deixar o gr√°fico de barras mais pr√≥ximo do gr√°fico original.
~~~ r
barplot(bfd$bfd$data.dist.freq,          # Valores de frequencia para cada barra
        names.arg = bfd$bfd$digits,      # Legenda de cada barra no eixo x
        col = "#A1DCF0",                 # Colora√ß√£o das barras
        main = "Digits Distribution",    # T√≠tulo principal
        xlab = "Digits",                 # Legenda eixo x
        ylab = "Freq",                   # Legenda eixo y
        ylim = range(0:6000),            # Limite no eixo y
        xlim = range(0:10),              # Limite no eixo x
        width = .85)                     # Largura da barra
~~~

Como gr√°ficos em R s√£o feitos por camadas, podemos adicionar a linha vermelha usando uma outra fun√ß√£o chamada `lines()`. Essa fun√ß√£o acrescenta uma nova camada em cima do gr√°fico plotado anteriormente criando uma linha ao ligar os pontos. No gr√°fico original, a linha vermelha corresponde a frequ√™ncia eperada quando aquele dataset conforma com a distribui√ß√£o de Benford, vejamos:

~~~ r
lines(x = bfd$bfd$benford.dist.freq,     # Pontos para formar a linha
      col = "red",                       # Cor da linha
      lwd=2.5,                           # Espessura da linha
      type="c")                          # Tipo da linha: tracejado
~~~

![frequ√™ncia de cada d√≠gito num gr√°fico de barras](https://raw.githubusercontent.com/jtemporal/talks/master/benfords-law/digits-distribution-population-us.png)
<center>
<i>Gr√°fico de barras gerado utilizando <code class="highlighter-rouge">barplot()</code>.</i>
</center>

Nota com a linha vermelha quase sobrep√µe o topo das barras de frequ√™ncia?!

## Benford pra qu√™?





## Links
- http://gigamatematica.blogspot.com.br/2011/07/lei-de-benford.html
- https://www.r-bloggers.com/benfords-law-graphed-in-r/
- http://www.businessinsider.com/benfords-law-to-detect-financial-fraud-2014-12
- github com codigo

![bla](https://media.giphy.com/media/d6WWh3Em7kWHu/giphy.gif)
